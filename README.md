# Go RESTful API loyalty service for Gophermart ⭐⭐⭐⭐⭐ 


## Начало


```shell
# запуск постгреса в докере
make db-start

# наполнить базу тестовыми данными
make testdata

# запуск
make run

# запуск с рестартом при любом изменение файлов проекта
# требуется fswatch
make run-live
```

Адрес `http://127.0.0.1:8080`. Эндпойнты:

* `POST /api/user/register` — регистрация пользователя;
* `POST /api/user/login` — аутентификация пользователя;
* `POST /api/user/orders` — загрузка пользователем номера заказа для расчёта;
* `GET /api/user/orders` — получение списка загруженных пользователем номеров заказов, статусов их обработки и информации о начислениях;
* `GET /api/user/balance` — получение текущего баланса счёта баллов лояльности пользователя;
* `POST /api/user/balance/withdraw` — запрос на списание баллов с накопительного счёта в счёт оплаты нового заказа;
* `GET /api/user/withdrawals` — получение информации о выводе средств с накопительного счёта пользователем.


## Структура проекта

 
```
.
├── cmd                        исполняемые файлы
│   ├── gophermart             сервис накопления баллов
│   └── accural                сервис расчёта баллов          
├── config                     файлы конфигураций для разных сред
├── internal                   приватные пакеты
│   ├── application            слой приложения
│   │   ├── errs               пакет с ошибками
│   │   ├── interfaces         здесь определены интерфейсы всех сервисов
│   │   ├── params             параметры вызова метода сервиса, если их много, объединены в структуры
│   │   └── services           реализация сервисов
│   ├── config                 пакет загрузки конфигурации приложения
│   ├── domain                 доменный слой
│   │   ├──  entities          сущности
│   │   └──  repositories      интерфейсы репозиториев
│   ├── infrastructure         инфраструктурный слой
│   │   └── db                 слой хранения
│   │       └── postgres       реализация хранилища в Postgres
│   └── interface              интерфейс взаимодействия с приложением
│       └── api                
│           └── rest           роутер, эндпойнты HTTP и их контракты
├── migrations                 файлы миграции
├── pkg                        публичные пакеты
│   ├── accesslog              логирование каждого запроса
│   ├── limiter                пакет отвечающий за лимитирование запросов к внешнему API
│   ├── logger                 логгер
│   ├── luhn                   алгоритм Луна валидации номера заказа
│   └── unzip                  распаковщик сжатых запросов
└── testdata                   тестовые данные
```